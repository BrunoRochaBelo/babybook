import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { Badge } from "./ui/badge";
import { ArrowLeft, Edit2, Plus, Image as ImageIcon, Video, Mic, Calendar, MoreVertical, Repeat, AlertCircle } from "lucide-react";
import { motion, AnimatePresence } from "motion/react";
import { useState } from "react";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "./ui/dropdown-menu";
import { Alert, AlertDescription } from "./ui/alert";
export function MomentViewer({ momentTitle, momentDescription, isRecurrent, records, babyName, onBack, onEdit, onAddNew }) {
    const [selectedRecord, setSelectedRecord] = useState(records.length === 1 ? records[0].id : null);
    const currentRecord = records.find(r => r.id === selectedRecord);
    const formatDate = (dateStr) => {
        const date = new Date(dateStr);
        return date.toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: 'long',
            year: 'numeric'
        });
    };
    const getTimeAgo = (dateStr) => {
        const date = new Date(dateStr);
        const now = new Date();
        const diffTime = Math.abs(now.getTime() - date.getTime());
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        if (diffDays === 0)
            return 'Hoje';
        if (diffDays === 1)
            return 'Ontem';
        if (diffDays < 7)
            return `${diffDays} dias atr치s`;
        if (diffDays < 30)
            return `${Math.floor(diffDays / 7)} semanas atr치s`;
        if (diffDays < 365)
            return `${Math.floor(diffDays / 30)} meses atr치s`;
        return `${Math.floor(diffDays / 365)} anos atr치s`;
    };
    return (_jsxs("div", { className: "min-h-screen bg-background pb-24", children: [_jsx("div", { className: "sticky top-0 z-10 bg-card/95 backdrop-blur-sm border-b border-border", children: _jsxs("div", { className: "max-w-4xl mx-auto px-4 py-4", children: [_jsxs(Button, { variant: "ghost", size: "sm", onClick: onBack, className: "mb-3 -ml-2 h-9", children: [_jsx(ArrowLeft, { className: "w-4 h-4 mr-2" }), "Voltar"] }), _jsx("div", { className: "flex items-start justify-between gap-3", children: _jsxs("div", { className: "flex-1", children: [_jsxs("div", { className: "flex items-center gap-2 mb-1 flex-wrap", children: [_jsx("h1", { className: "text-xl sm:text-2xl md:text-3xl", children: momentTitle }), isRecurrent && (_jsxs(Badge, { variant: "secondary", className: "text-xs", children: [_jsx(Repeat, { className: "w-3 h-3 mr-1" }), "Recorrente"] }))] }), _jsx("p", { className: "text-xs sm:text-sm text-muted-foreground", children: momentDescription }), isRecurrent && (_jsxs("p", { className: "text-xs sm:text-sm text-accent mt-1", children: [records.length, " ", records.length === 1 ? 'registro' : 'registros'] }))] }) })] }) }), _jsx("div", { className: "max-w-4xl mx-auto px-4 py-6 sm:py-8", children: isRecurrent && records.length > 1 ? (
                /* Recurrent Timeline View */
                _jsxs("div", { className: "space-y-6", children: [_jsx(motion.div, { initial: { opacity: 0, y: -10 }, animate: { opacity: 1, y: 0 }, children: _jsxs(Alert, { className: "bg-accent/10 border-accent/30", children: [_jsx(Repeat, { className: "h-4 w-4 text-accent" }), _jsxs(AlertDescription, { className: "text-sm", children: ["Este \u00E9 um momento recorrente. Voc\u00EA tem ", _jsxs("strong", { children: [records.length, " registros"] }), " guardados. Toque em um para ver os detalhes ou adicione um novo registro."] })] }) }), _jsx("div", { className: "space-y-3", children: records
                                .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
                                .map((record, index) => (_jsx(motion.div, { initial: { opacity: 0, x: -20 }, animate: { opacity: 1, x: 0 }, transition: { delay: index * 0.05 }, children: _jsx(Card, { className: `p-4 cursor-pointer transition-all duration-200 ${selectedRecord === record.id
                                        ? 'border-primary shadow-md'
                                        : 'hover:border-primary/30 hover:shadow-sm'}`, onClick: () => setSelectedRecord(record.id), children: _jsxs("div", { className: "flex items-start gap-3", children: [_jsx("div", { className: "flex-shrink-0 pt-1", children: _jsx("div", { className: `w-3 h-3 rounded-full ${selectedRecord === record.id
                                                        ? 'bg-primary'
                                                        : 'bg-muted-foreground/30'}` }) }), _jsxs("div", { className: "flex-1 min-w-0", children: [_jsxs("div", { className: "flex items-start justify-between gap-2 mb-2", children: [_jsxs("div", { children: [_jsxs("div", { className: "flex items-center gap-2 mb-1", children: [_jsx(Calendar, { className: "w-4 h-4 text-muted-foreground" }), _jsx("span", { className: "text-sm", children: formatDate(record.date) })] }), _jsxs("p", { className: "text-xs text-muted-foreground", children: [getTimeAgo(record.date), " \u2022 ", record.ageAtMoment || `${babyName} com X meses`] })] }), _jsxs(DropdownMenu, { children: [_jsx(DropdownMenuTrigger, { asChild: true, children: _jsx(Button, { variant: "ghost", size: "icon", className: "h-8 w-8 rounded-full", onClick: (e) => e.stopPropagation(), children: _jsx(MoreVertical, { className: "w-4 h-4" }) }) }), _jsx(DropdownMenuContent, { align: "end", children: _jsxs(DropdownMenuItem, { onClick: () => onEdit(record.id), children: [_jsx(Edit2, { className: "w-4 h-4 mr-2" }), "Editar registro"] }) })] })] }), record.media.length > 0 && (_jsxs("div", { className: "flex gap-2 mb-2", children: [record.media.slice(0, 3).map((media, idx) => (_jsx("div", { className: "w-12 h-12 rounded-lg bg-muted flex items-center justify-center overflow-hidden", children: media.thumbnail ? (_jsx("img", { src: media.thumbnail, alt: "Preview", className: "w-full h-full object-cover" })) : (_jsxs(_Fragment, { children: [media.type === 'photo' && _jsx(ImageIcon, { className: "w-5 h-5 text-muted-foreground" }), media.type === 'video' && _jsx(Video, { className: "w-5 h-5 text-muted-foreground" }), media.type === 'audio' && _jsx(Mic, { className: "w-5 h-5 text-muted-foreground" })] })) }, idx))), record.media.length > 3 && (_jsxs("div", { className: "w-12 h-12 rounded-lg bg-muted flex items-center justify-center text-xs text-muted-foreground", children: ["+", record.media.length - 3] }))] })), record.story && (_jsx("p", { className: "text-sm text-muted-foreground line-clamp-2", children: record.story }))] })] }) }) }, record.id))) }), _jsx(AnimatePresence, { mode: "wait", children: selectedRecord && currentRecord && (_jsx(motion.div, { initial: { opacity: 0, y: 20 }, animate: { opacity: 1, y: 0 }, exit: { opacity: 0, y: -20 }, transition: { duration: 0.3 }, children: _jsxs(Card, { className: "p-6 bg-gradient-to-br from-primary/5 to-accent/5 border-primary/20", children: [_jsxs("div", { className: "flex items-start justify-between mb-4", children: [_jsxs("div", { children: [_jsx("h3", { className: "text-lg mb-1", children: "Detalhes do Registro" }), _jsx("p", { className: "text-sm text-muted-foreground", children: formatDate(currentRecord.date) })] }), _jsxs(Button, { variant: "outline", size: "sm", onClick: () => onEdit(currentRecord.id), className: "rounded-xl", children: [_jsx(Edit2, { className: "w-4 h-4 mr-2" }), "Editar"] })] }), currentRecord.media.length > 0 && (_jsxs("div", { className: "mb-4", children: [_jsxs("h4", { className: "text-sm mb-3", children: ["M\u00EDdias (", currentRecord.media.length, ")"] }), _jsx("div", { className: "grid grid-cols-2 sm:grid-cols-3 gap-3", children: currentRecord.media.map((media, idx) => (_jsx("div", { className: "aspect-square rounded-xl bg-muted flex items-center justify-center overflow-hidden", children: media.thumbnail ? (_jsx("img", { src: media.thumbnail, alt: "Media", className: "w-full h-full object-cover" })) : (_jsxs(_Fragment, { children: [media.type === 'photo' && _jsx(ImageIcon, { className: "w-8 h-8 text-muted-foreground" }), media.type === 'video' && _jsx(Video, { className: "w-8 h-8 text-muted-foreground" }), media.type === 'audio' && _jsx(Mic, { className: "w-8 h-8 text-muted-foreground" })] })) }, idx))) })] })), currentRecord.story && (_jsxs("div", { children: [_jsx("h4", { className: "text-sm mb-2", children: "Hist\u00F3ria" }), _jsx("p", { className: "text-sm text-muted-foreground leading-relaxed", children: currentRecord.story })] })), !currentRecord.story && currentRecord.media.length === 0 && (_jsxs("div", { className: "text-center py-8", children: [_jsx(AlertCircle, { className: "w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-50" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "Este registro n\u00E3o tem hist\u00F3ria ou m\u00EDdias ainda." }), _jsxs(Button, { variant: "outline", size: "sm", onClick: () => onEdit(currentRecord.id), className: "mt-3", children: [_jsx(Edit2, { className: "w-4 h-4 mr-2" }), "Adicionar detalhes"] })] }))] }) }, selectedRecord)) })] })) : (
                /* Single Record View */
                _jsx(motion.div, { initial: { opacity: 0, y: 20 }, animate: { opacity: 1, y: 0 }, transition: { duration: 0.5 }, children: _jsxs(Card, { className: "p-6 sm:p-8", children: [_jsxs("div", { className: "flex items-start justify-between mb-6", children: [_jsxs("div", { children: [_jsxs("div", { className: "flex items-center gap-2 mb-2", children: [_jsx(Calendar, { className: "w-5 h-5 text-primary" }), _jsx("span", { className: "text-base sm:text-lg", children: formatDate(records[0].date) })] }), _jsxs("p", { className: "text-sm text-muted-foreground", children: [getTimeAgo(records[0].date), " \u2022 ", records[0].ageAtMoment || `${babyName} com X meses`] })] }), _jsxs(Button, { variant: "outline", size: "sm", onClick: () => onEdit(records[0].id), className: "rounded-xl", children: [_jsx(Edit2, { className: "w-4 h-4 mr-2" }), "Editar"] })] }), records[0].media.length > 0 && (_jsxs("div", { className: "mb-6", children: [_jsx("h4", { className: "text-sm sm:text-base mb-3", children: "M\u00EDdias" }), _jsx("div", { className: "grid grid-cols-2 sm:grid-cols-3 gap-3", children: records[0].media.map((media, idx) => (_jsx("div", { className: "aspect-square rounded-xl bg-muted flex items-center justify-center overflow-hidden", children: media.thumbnail ? (_jsx("img", { src: media.thumbnail, alt: "Media", className: "w-full h-full object-cover" })) : (_jsxs(_Fragment, { children: [media.type === 'photo' && _jsx(ImageIcon, { className: "w-8 h-8 sm:w-10 sm:h-10 text-muted-foreground" }), media.type === 'video' && _jsx(Video, { className: "w-8 h-8 sm:w-10 sm:h-10 text-muted-foreground" }), media.type === 'audio' && _jsx(Mic, { className: "w-8 h-8 sm:w-10 sm:h-10 text-muted-foreground" })] })) }, idx))) })] })), records[0].story && (_jsxs("div", { children: [_jsx("h4", { className: "text-sm sm:text-base mb-3", children: "Hist\u00F3ria" }), _jsx("p", { className: "text-sm sm:text-base text-muted-foreground leading-relaxed", children: records[0].story })] })), !records[0].story && records[0].media.length === 0 && (_jsxs("div", { className: "text-center py-12", children: [_jsx(AlertCircle, { className: "w-16 h-16 text-muted-foreground mx-auto mb-4 opacity-50" }), _jsx("h3", { className: "mb-2", children: "Momento registrado" }), _jsx("p", { className: "text-sm text-muted-foreground mb-4", children: "Este momento foi salvo, mas ainda n\u00E3o tem hist\u00F3ria ou m\u00EDdias." }), _jsxs(Button, { onClick: () => onEdit(records[0].id), className: "rounded-xl", children: [_jsx(Edit2, { className: "w-4 h-4 mr-2" }), "Adicionar detalhes"] })] }))] }) })) }), isRecurrent && (_jsx("div", { className: "fixed bottom-0 left-0 right-0 bg-card/95 backdrop-blur-sm border-t border-border shadow-lg safe-area-inset-bottom", children: _jsxs("div", { className: "max-w-4xl mx-auto px-4 py-3 sm:py-4", children: [_jsxs(Button, { onClick: onAddNew, className: "w-full h-12 sm:h-14 rounded-2xl bg-primary hover:bg-primary/90 transition-smooth", children: [_jsx(Plus, { className: "w-5 h-5 mr-2" }), _jsx("span", { className: "text-sm sm:text-base", children: "Adicionar Novo Registro" })] }), _jsx("p", { className: "text-xs text-center text-muted-foreground mt-2", children: "Registre mais uma vez que este momento aconteceu" })] }) }))] }));
}
